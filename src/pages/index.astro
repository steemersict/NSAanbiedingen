---
import Layout from "@/layouts/Layout.astro";
import Editor from "@/components/Editor.tsx";
---

<Layout title="NSAanbiedingen - PDF Offer Folder Generator">
  <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">NSAanbiedingen</h1>
            <p class="text-gray-600 mt-1">
              Create professional PDF offer folders with ease
            </p>
          </div>
          <div id="status" class="text-right">
            <p class="text-sm text-gray-600">
              <span id="status-indicator" class="inline-block w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>
              <span id="status-text">Initializing...</span>
            </p>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div id="app-container" class="hidden">
        <!-- Editor will be mounted here by React -->
        <Editor client:load />
      </div>

      <!-- Loading State -->
      <div
        id="loading-container"
        class="text-center py-12 bg-white rounded-lg shadow-md"
      >
        <div class="inline-block mb-4">
          <div class="spinner"></div>
        </div>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">
          Initializing Backend...
        </h2>
        <p class="text-gray-600">
          Connecting to the PDF generation service. This may take a moment.
        </p>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-gray-600 text-sm">
        <p>Â© 2025 NSAanbiedingen. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <script>
    // Handle backend ready event
    window.addEventListener("backend-ready", (event: any) => {
      const port = event.detail.port;
      console.log("[App] Backend is ready on port", port);

      // Update status
      document.getElementById("status-indicator")!.className =
        "inline-block w-3 h-3 bg-green-500 rounded-full mr-2";
      document.getElementById("status-text")!.textContent = `Ready (port ${port})`;

      // Show editor and hide loading state
      document.getElementById("loading-container")!.classList.add("hidden");
      document.getElementById("app-container")!.classList.remove("hidden");

      // Store port in global state or localStorage for components to use
      window.localStorage.setItem("backend-port", port.toString());
    });

    // Timeout if backend doesn't start within 10 seconds
    setTimeout(() => {
      if (
        document.getElementById("status-indicator")!.className.includes("yellow")
      ) {
        document.getElementById("status-text")!.textContent =
          "Backend initialization timeout. Check console for details.";
        document.getElementById("status-indicator")!.className =
          "inline-block w-3 h-3 bg-red-500 rounded-full mr-2";
      }
    }, 10000);
  </script>
</Layout>

<style is:global>
  #app-container {
    transition: opacity 0.3s ease-in-out;
  }

  #loading-container {
    transition: opacity 0.3s ease-in-out;
  }

  .hidden {
    display: none !important;
  }
</style>
